<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{common/layout :: layout(~{::content})}">
<body>
<div th:fragment="content">
  <h3 class="mb-4">
    <i class="bi bi-cart3"></i> GIỎ HÀNG
    (<span th:text="${cart.totalItems}">0</span>)
  </h3>

  <!-- Giỏ hàng rỗng -->
  <div th:if="${#maps.isEmpty(cart.items)}" class="text-center py-5">
    <i class="bi bi-cart-x" style="font-size: 4rem; color: #ccc;"></i>
    <p class="text-muted mt-3">Giỏ hàng trống</p>
    <a th:href="@{/products}" class="btn btn-primary">Tiếp tục mua sắm</a>
  </div>

  <!-- Danh sách sản phẩm -->
  <div th:if="${!#maps.isEmpty(cart.items)}">
    <table class="table">
      <thead>
      <tr>
        <th>Sản phẩm</th>
        <th>Đơn giá</th>
        <th>Số lượng</th>
        <th>Thành tiền</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${cartItems}">
        <td>
          <img th:src="${item.imageUrl}" style="width:50px; height:50px; object-fit:cover;" class="me-2">
          <span th:text="${item.productName}">Tên SP</span>
        </td>
        <td th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
        <td>
          <form th:action="@{/cart/update/{id}(id=${item.productId})}" method="post" class="d-inline">
            <input type="hidden" name="quantity" th:value="${item.quantity - 1}">
            <button type="submit" class="btn btn-sm btn-outline-secondary">-</button>
          </form>
          <span class="mx-2" th:text="${item.quantity}">1</span>
          <form th:action="@{/cart/update/{id}(id=${item.productId})}" method="post" class="d-inline">
            <input type="hidden" name="quantity" th:value="${item.quantity + 1}">
            <button type="submit" class="btn btn-sm btn-outline-secondary">+</button>
          </form>
        </td>
        <td class="text-danger" th:text="${#numbers.formatDecimal(item.subTotal, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
        <td>
          <form th:action="@{/cart/remove/{id}(id=${item.productId})}" method="post">
            <button type="submit" class="btn btn-sm btn-danger"
                    onclick="return confirm('Xóa sản phẩm này?')">
              <i class="bi bi-trash"></i>
            </button>
          </form>
        </td>
      </tr>
      </tbody>
    </table>

    <!-- Tổng cộng -->
    <div class="text-end">
      <h4>Tổng cộng:
        <span class="text-danger" th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')} + ' đ'"></span>
      </h4>
      <form th:action="@{/cart/checkout}" method="post" class="mt-3">
        <button type="submit" class="btn btn-success btn-lg">
          <i class="bi bi-credit-card"></i> Thanh toán
        </button>
      </form>
    </div>
  </div>
</div>
</body>
</html>